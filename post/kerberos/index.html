<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <title>
      
      Creación de un sistema de cuentas de usuarios en GNU/Linux con LDAP, Kerberos 5 y NFS4 - De Rookie a Leyenda
      
		</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/icons.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    
    <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Lato:100,100i,300,300i,400,400i,700,700i|Source+Code+Pro:300,400,500,700" rel="stylesheet">
    

    
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/bigfoot/dist/bigfoot.js"></script>
    <link rel="stylesheet" type="text/css" href="/assets/bigfoot/dist/bigfoot-number.css" />
    <script type="text/javascript">
        $.bigfoot();
    </script>
    
    
</head>

    <body class="post-template">
        <header class="main-header">
	<div class="main-header-content">
		<h1 class="blog-title">
			<a href="/">
				
           De Rookie a Leyenda
				
			</a>
		</h1>
		<h2 class="blog-description">Ernesto Vázquez García</h2>
	</div>

	<div class="nav">
    
		
	</div>
</header>

        
<main class="content" role="main">
  <article class="post">
    <header class="post-header">
      
      <h2 class="post-title">Creación de un sistema de cuentas de usuarios en GNU/Linux con LDAP, Kerberos 5 y NFS4</h2>
      <section class="post-meta">
        <time class="post-date">February 10, 2020</time>
      </section>
    </header>
    <section class="post-content">
      

<p>Complementa el directorio instalado en croqueta creando un sistema centralizado de cuentas de usuarios en GNU/Linux con LDAP, Kerberos 5 y NFS4.</p>

<p>Utiliza el manual de <a href="http://albertomolina.files.wordpress.com/2014/01/krb_ldap.pdf">http://albertomolina.files.wordpress.com/2014/01/krb_ldap.pdf</a></p>

<p>Ten en cuenta que en este caso es necesario que el directorio home del usuario esté centralizado y para eso es para lo que se utiliza NFSv4 con kerberos, que no aparece en la documentación.</p>

<p>Forma de corregir:</p>

<ul>
<li>Se hace login en tortilla con un usuario que esté en kerberos para lo que hay que facilitar la contraseña del principal.</li>
<li>Los datos de la cuenta del usuario deben estar en el LDAP de croqueta</li>
<li>Se comprueba que al hacer login se crea el TGT de kerberos y el TGS de LDAP mediante &ldquo;klist -5&rdquo;</li>
<li>El directorio home del usuario debe estar disponible a través de NFS4y se comprueba creando un fichero</li>
<li>Se accede por ssh a croqueta de forma transparente (no debe pedir contraseña ni usar clave pública/privada), el fichero creado anteriormente debe estar en el nuevo equipo.</li>
<li>Se accede de nuevo por ssh a tortilla y se comprueba la generación correcta de los TGS</li>
</ul>

<hr />

<h2 id="introducción">Introducción</h2>

<h2 id="configuración-del-dns">Configuración del DNS</h2>

<p>Para empezar tenemos que hacer algunas <strong>configuraciones previas</strong>, una de ellas es la <strong>configuración del DNS</strong>, en nuestro caso con <strong>Bind9</strong></p>

<p>Para ello editamos el siguiente fichero:</p>

<pre><code>debian@croqueta:~$ sudo nano /var/cache/bind/db.ernesto.gonzalonazareno.org 

kerberos        IN      CNAME   croqueta
ldap            IN      CNAME   croqueta
_kerberos               IN      TXT     &quot;ERNESTO.GONZALONAZARENO.ORG&quot;
_kerberos._udp          IN      SRV     0 0 88          kerberos.ernesto.gonzalonazareno.org.
_kerberos_adm._tcp      IN      SRV     0 0 749         kerberos.ernesto.gonzalonazareno.org.
_ldap._tcp              IN      SRV     0 0 389         kerberos.ernesto.gonzalonazareno.org.
</code></pre>

<p>Posteriormente reiniciamos y probamos si hace bien la consulta mediante dig:</p>

<pre><code>debian@croqueta:~$ sudo systemctl restart bind9

debian@croqueta:~$ dig ldap.ernesto.gonzalonazareno.org

; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1-Debian &lt;&lt;&gt;&gt; ldap.ernesto.gonzalonazareno.org
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 42319
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: 0e030eed954c2ff892fd7a2e5e53ab6b3c028f8af87f20ca (good)
;; QUESTION SECTION:
;ldap.ernesto.gonzalonazareno.org. IN	A

;; ANSWER SECTION:
ldap.ernesto.gonzalonazareno.org. 604784 IN CNAME croqueta.ernesto.gonzalonazareno.org.
croqueta.ernesto.gonzalonazareno.org. 604784 IN	A 172.22.200.111

;; AUTHORITY SECTION:
ernesto.gonzalonazareno.org. 86400 IN	NS	croqueta.ernesto.gonzalonazareno.org.

;; Query time: 1 msec
;; SERVER: 192.168.202.2#53(192.168.202.2)
;; WHEN: Mon Feb 24 11:54:35 CET 2020
;; MSG SIZE  rcvd: 142
</code></pre>

<h2 id="servidor-de-hora">Servidor de hora</h2>

<p>Este paso es muy importante ya que ambas máquinas tienen que tener la misma fecha y hora.</p>

<p>Podremos usar ntp:</p>

<pre><code>debian@croqueta:~$ sudo apt install ntp
</code></pre>

<p>Solamente tendremos que añadir en el fichero <code>/etc/ntpd.conf</code> el servidor croqueta.</p>

<h2 id="servidor-ldap">Servidor LDAP</h2>

<p>Vamos a crear el usuario y el grupo en un nuevo fichero.</p>

<blockquote>
<p>Tengo que añadir, que las dos unidades organizativas (ou) llamadas People y Group, se han reutilizado de la práctica anterior de LDAP.</p>
</blockquote>

<pre><code>debian@croqueta:~/kerberos$ nano inicio.ldif

dn: cn=pruebagroup,ou=Group,dc=ernesto,dc=gonzalonazareno,dc=org
objectClass: posixGroup
objectClass: top
cn: pruebagroup
gidNumber: 2012

dn: uid=pruebauser,ou=People,dc=ernesto,dc=gonzalonazareno,dc=org
objectClass: account
objectClass: posixAccount
objectClass: top
cn: pruebauser
uid: pruebauser
loginShell: /bin/bash
uidNumber: 2510
gidNumber: 2012
homeDirectory: /home/users/pruebauser
</code></pre>

<p>Lo añadimos con el siguiente comando:</p>

<pre><code>debian@croqueta:~/kerberos$ ldapadd -f inicio.ldif -x -D &quot;cn=admin,dc=ernesto,dc=gonzalonazareno,dc=org&quot; -W
Enter LDAP Password: 
adding new entry &quot;cn=pruebagroup,ou=Group,dc=ernesto,dc=gonzalonazareno,dc=org&quot;

adding new entry &quot;uid=pruebauser,ou=People,dc=ernesto,dc=gonzalonazareno,dc=org&quot;
</code></pre>

<p>A continuación tenemos que editar el fichero debian@croqueta:~$ sudo nano <code>/etc/ldap/ldap.conf.</code></p>

<pre><code>debian@croqueta:~$ sudo nano /etc/ldap/ldap.conf

BASE    dc=ernesto,dc=gonzalonazareno,dc=org
URI     ldap://ldap.ernesto.gonzalonazareno.org
</code></pre>

<p>Ahora vamos a crear el directorio y le asignamos el grupo correcto.</p>

<pre><code>debian@croqueta:~$ sudo mkdir -p /home/users/pruebauser

debian@croqueta:~$ sudo cp /etc/skel/.bash_logout /home/users/pruebauser/
debian@croqueta:~$ sudo cp /etc/skel/.bashrc /home/users/pruebauser/
debian@croqueta:~$ sudo cp /etc/skel/.profile /home/users/pruebauser/

debian@croqueta:/home/users/pruebauser$ ls -al
total 20
drwxr-xr-x 2 root root 4096 Feb 24 12:52 .
drwxr-xr-x 3 root root 4096 Feb 24 12:51 ..
-rw-r--r-- 1 root root  220 Feb 24 12:53 .bash_logout
-rw-r--r-- 1 root root 3526 Feb 24 12:53 .bashrc
-rw-r--r-- 1 root root  807 Feb 24 12:53 .profile

debian@croqueta:~$ sudo chown -R 2510:2012 /home/users/pruebauser/

debian@croqueta:/home/users/pruebauser$ ls -al
total 20
drwxr-xr-x 2 2510 2012 4096 Feb 24 12:52 .
drwxr-xr-x 3 root root 4096 Feb 24 12:51 ..
-rw-r--r-- 1 2510 2012  220 Feb 24 12:53 .bash_logout
-rw-r--r-- 1 2510 2012 3526 Feb 24 12:53 .bashrc
-rw-r--r-- 1 2510 2012  807 Feb 24 12:53 .profile
</code></pre>

<h2 id="configuración-del-cliente-ldap-name-service-switch-nss">Configuración del cliente LDAP. Name Service Switch (NSS)</h2>

<p>Para la autenticación de usuarios con LDAP debemos instalar el paquete <code>libnss-ldap</code>.</p>

<pre><code>debian@croqueta:~$ sudo apt install --no-install-recommends libnss-ldap
</code></pre>

<p><img src="https://i.imgur.com/js6Rlss.png" alt="" /></p>

<p><img src="https://i.imgur.com/GNRasK7.png" alt="" /></p>

<p><img src="https://i.imgur.com/GPFFTR3.png" alt="" /></p>

<p>Las siguientes pantallas las podemos ignorar de momento.</p>

<p>Si queremos volver a configurar solamente tendremos que poder lo siguiente:</p>

<pre><code>debian@croqueta:~$ sudo dpkg-reconfigure libnss-ldap
</code></pre>

<p>A continuación nos dirigimos al fichero de configuración <code>/etc/libnss-ldap.conf</code> parra comentar la siguiente línea</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/libnss-ldap.conf 

#rootbinddn cn=manager,dc=example,dc=net
</code></pre>

<p>En el caso de que exista contraseña del administrador de LDAP se borraría:</p>

<pre><code>debian@croqueta:~$ rm -f /etc/libnss-ldap.secret
</code></pre>

<p>Ahora vamos a configurar las líneas de passwd y group, donde le indicaremos al sistema que busque en directorios LDAP y files.</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/nsswitch.conf

passwd:         ldap files
group:          ldap files
</code></pre>

<p>Para comprobar el correcto funcionamiento de nss con ldap, realizaremos el mismo listado que antes.</p>

<pre><code>debian@croqueta:~/kerberos$ ls -al /home/users/pruebauser/
total 20
drwxr-xr-x 2 pruebauser pruebagroup 4096 Feb 24 12:52 .
drwxr-xr-x 3 root       root        4096 Feb 24 12:51 ..
-rw-r--r-- 1 pruebauser pruebagroup  220 Feb 24 12:53 .bash_logout
-rw-r--r-- 1 pruebauser pruebagroup 3526 Feb 24 12:53 .bashrc
-rw-r--r-- 1 pruebauser pruebagroup  807 Feb 24 12:53 .profile
</code></pre>

<p>Como podemos apreciar se han cambiado el UID/GID por el correspondiente, obtenido mediante una consulta al directorio LDAP.</p>

<p>Otra forma de hacer la consulta es mediante el uso de <code>getent</code>, podemos verlo con el siguiente comando.</p>

<pre><code>debian@croqueta:~$ getent passwd pruebauser 
pruebauser:*:2510:2012:pruebauser:/home/users/pruebauser:/bin/bash

debian@croqueta:~$ getent group pruebagroup 
pruebagroup:*:2012:
</code></pre>

<h2 id="instalación-del-servidor-mit-kerberos-5">Instalación del servidor MIT Kerberos 5</h2>

<p>Vamos a instalar el servidor Kerberos y a la correspondiente configuración.</p>

<pre><code>debian@croqueta:~$ apt install krb5-kdc krb5-admin-server
</code></pre>

<p><img src="https://i.imgur.com/rkeVckH.png" alt="" /></p>

<p>Al finalizar la instalación nos dirigimos al siguiente fichero de configuración:</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/krb5kdc/kdc.conf

[kdcdefaults]
    kdc_ports = 750,88

[realms]
    ERNESTO.GONZALONAZARENO.ORG = {
        database_name = /var/lib/krb5kdc/principal
        admin_keytab = FILE:/etc/krb5kdc/kadm5.keytab
        acl_file = /etc/krb5kdc/kadm5.acl
        key_stash_file = /etc/krb5kdc/stash
        kdc_ports = 750,88
        max_life = 10h 0m 0s
        max_renewable_life = 7d 0h 0m 0s
        master_key_type = des3-hmac-sha1
        #supported_enctypes = aes256-cts:normal aes128-cts:normal
        default_principal_flags = +preauth
    }
</code></pre>

<p>Ahora tendremos que <strong>quitar el puerto 750.</strong></p>

<pre><code>[kdcdefaults]
    kdc_ports = 88

[realms]
    ERNESTO.GONZALONAZARENO.ORG = {
        database_name = /var/lib/krb5kdc/principal
        admin_keytab = FILE:/etc/krb5kdc/kadm5.keytab
        acl_file = /etc/krb5kdc/kadm5.acl
        key_stash_file = /etc/krb5kdc/stash
        kdc_ports = 88
        max_life = 10h 0m 0s
        max_renewable_life = 7d 0h 0m 0s
        master_key_type = des3-hmac-sha1
        #supported_enctypes = aes256-cts:normal aes128-cts:normal
        default_principal_flags = +preauth
    }
</code></pre>

<p>En caso de necesitar <strong>desactivar Kerberos 4</strong> nos dirigimos al fichero de configuración <code>/etc/default/krb5-kdc.</code></p>

<pre><code>KRB4_MODE = disable
RUN_KRB524D = false
</code></pre>

<p>Para deshabilitar por completo la utilización de Kerberos4.</p>

<p>Añadimos las siguientes líneas.</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/krb5.conf

[libdefaults]
        default_realm = ERNESTO.GONZALONAZARENO.ORG
...
[realms]
        ERNESTO.GONZALONAZARENO.ORG = {
                kdc = kerberos.ernesto.gonzalonazareno.org
                admin_server = kerberos.ernesto.gonzalonazareno.org
        }

...
[domain_realm]
        .ernesto.gonzalonazareno.org = ERNESTO.GONZALONAZARENO.ORG
        ernesto.gonzalonazareno.org = ERNESTO.GONZALONAZARENO.ORG
</code></pre>

<p>A continuación lo agregamos con el comando <code>krb5_newrealm</code>, donde nos pedirá la clave maestra de Kerberos.</p>

<pre><code>debian@croqueta:~$ sudo krb5_newrealm

This script should be run on the master KDC/admin server to initialize
a Kerberos realm.  It will ask you to type in a master key password.
This password will be used to generate a key that is stored in
/etc/krb5kdc/stash.  You should try to remember this password, but it
is much more important that it be a strong password than that it be
remembered.  However, if you lose the password and /etc/krb5kdc/stash,
you cannot decrypt your Kerberos database.
Loading random data
Initializing database '/var/lib/krb5kdc/principal' for realm 'ERNESTO.GONZALONAZARENO.ORG',
master key name 'K/M@ERNESTO.GONZALONAZARENO.ORG'
You will be prompted for the database Master Password.
It is important that you NOT FORGET this password.
Enter KDC database master key: 
Re-enter KDC database master key to verify: 


Now that your realm is set up you may wish to create an administrative
principal using the addprinc subcommand of the kadmin.local program.
Then, this principal can be added to /etc/krb5kdc/kadm5.acl so that
you can use the kadmin program on other computers.  Kerberos admin
principals usually belong to a single user and end in /admin.  For
example, if jruser is a Kerberos administrator, then in addition to
the normal jruser principal, a jruser/admin principal should be
created.

Don't forget to set up DNS information so your clients can find your
KDC and admin servers.  Doing so is documented in the administration
guide.
</code></pre>

<p>Posteriormente reiniciamos los servicios:</p>

<pre><code>debian@croqueta:~$ sudo systemctl restart krb5-kdc
debian@croqueta:~$ sudo systemctl restart krb5-admin-server
</code></pre>

<p>Podremos ver los principales que se generan automáticamente al instalar el servidor <strong>kadmin</strong>:</p>

<pre><code>root@croqueta:~# kadmin.local
Authenticating as principal root/admin@ERNESTO.GONZALONAZARENO.ORG with password.
kadmin.local:  list_principals
K/M@ERNESTO.GONZALONAZARENO.ORG
kadmin/admin@ERNESTO.GONZALONAZARENO.ORG
kadmin/changepw@ERNESTO.GONZALONAZARENO.ORG
kadmin/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG
kiprop/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG
krbtgt/ERNESTO.GONZALONAZARENO.ORG@ERNESTO.GONZALONAZARENO.ORG
</code></pre>

<p>A continuación vamos a crear los principales para el usuario <strong>pruebauser</strong></p>

<pre><code>kadmin.local:  add_principal pruebauser
WARNING: no policy specified for pruebauser@ERNESTO.GONZALONAZARENO.ORG; defaulting to no policy
Enter password for principal &quot;pruebauser@ERNESTO.GONZALONAZARENO.ORG&quot;: 
Re-enter password for principal &quot;pruebauser@ERNESTO.GONZALONAZARENO.ORG&quot;: 
Principal &quot;pruebauser@ERNESTO.GONZALONAZARENO.ORG&quot; created.

kadmin.local:  add_principal -randkey host/croqueta.ernesto.gonzalonazareno.org
WARNING: no policy specified for host/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG; defaulting to no policy
Principal &quot;host/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG&quot; created.

kadmin.local:  add_principal -randkey host/tortilla.ernesto.gonzalonazareno.org
WARNING: no policy specified for host/tortilla.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG; defaulting to no policy
Principal &quot;host/tortilla.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG&quot; created.

kadmin.local:  add_principal -randkey ldap/croqueta.ernesto.gonzalonazareno.org
WARNING: no policy specified for ldap/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG; defaulting to no policy
Principal &quot;ldap/croqueta.ernesto.gonzalonazareno.org@ERNESTO.GONZALONAZARENO.ORG&quot; created.
</code></pre>

<h2 id="ficheros-keytab">Ficheros keytab</h2>

<p>En este apartado vamos a configurar los ficheros keytab para las claves cifradas puedan autenticarse contra el servidor Kerberos de forma no interactiva.</p>

<pre><code>kadmin.local:  ktadd host/croqueta.ernesto.gonzalonazareno.org
Entry for principal host/croqueta.ernesto.gonzalonazareno.org with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.
Entry for principal host/croqueta.ernesto.gonzalonazareno.org with kvno 2, encryption type aes128-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.

kadmin.local:  ktadd ldap/croqueta.ernesto.gonzalonazareno.org
Entry for principal ldap/croqueta.ernesto.gonzalonazareno.org with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.
Entry for principal ldap/croqueta.ernesto.gonzalonazareno.org with kvno 2, encryption type aes128-cts-hmac-sha1-96 added to keytab FILE:/etc/krb5.keytab.
</code></pre>

<h2 id="creación-de-usuarios-para-la-administración-de-kerberos">Creación de usuarios para la administración de Kerberos</h2>

<p>Para crear un rol de administración con todos los permisos hay que descomentar la siguiente línea.</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/krb5kdc/kadm5.acl

# */admin *
</code></pre>

<p>A continuación accedemos de nuevo a <code>kadmin.local</code>.</p>

<pre><code>debian@croqueta:~$ sudo kadmin.local

Authenticating as principal root/admin@ERNESTO.GONZALONAZARENO.ORG with password.
kadmin.local:  add_principal ernestovazgar/admin
WARNING: no policy specified for ernestovazgar/admin@ERNESTO.GONZALONAZARENO.ORG; defaulting to no policy
Enter password for principal &quot;ernestovazgar/admin@ERNESTO.GONZALONAZARENO.ORG&quot;: 
Re-enter password for principal &quot;ernestovazgar/admin@ERNESTO.GONZALONAZARENO.ORG&quot;: 
Principal &quot;ernestovazgar/admin@ERNESTO.GONZALONAZARENO.ORG&quot; created.
</code></pre>

<p>De esta manera hemos crear un principal para un usuario administrador.</p>

<h2 id="configuración-del-cliente-kerberos">Configuración del cliente Kerberos</h2>

<p>A continuación vamos a instalar el cliente kerberos en tortilla.</p>

<pre><code>ubuntu@tortilla:~$ sudo apt install krb5-config krb5-user
</code></pre>

<p>Editamos el fichero de configuración <code>/etc/krb5.conf,</code> al igual que en el servidor.</p>

<pre><code>ubuntu@tortilla:~$ sudo nano /etc/krb5.conf 

[libdefaults]
        default_realm = ERNESTO.GONZALONAZARENO.ORG
...
[realms]
        ERNESTO.GONZALONAZARENO.ORG = {
                kdc = kerberos.ernesto.gonzalonazareno.org
                admin_server = kerberos.ernesto.gonzalonazareno.org
        }

...
[domain_realm]
        .ernesto.gonzalonazareno.org = ERNESTO.GONZALONAZARENO.ORG
        ernesto.gonzalonazareno.org = ERNESTO.GONZALONAZARENO.ORG
</code></pre>

<h2 id="klist-y-knit">klist y knit</h2>

<p>Para ver los tickets de la sesión de usuario utilizarenos el comanto <code>klist -5</code> (Pero antes tenemos que autenticarnos), en caso de no estar autenticados saltaria la siguiente salida:</p>

<p><code>klist: No credentials cache found (ticket cache FILE:/tmp/krb5cc_0)</code></p>

<p>Para autenticarnos utilizarenos <code>kinit</code> seguido del nombre de usuario.</p>

<pre><code>root@tortilla:/home/ubuntu# kinit pruebauser
Password for pruebauser@ERNESTO.GONZALONAZARENO.ORG: 

root@tortilla:/home/ubuntu# klist -5
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: pruebauser@ERNESTO.GONZALONAZARENO.ORG

Valid starting     Expires            Service principal
02/25/20 19:20:57  02/26/20 05:20:57  krbtgt/ERNESTO.GONZALONAZARENO.ORG@ERNESTO.GONZALONAZARENO.ORG
	renew until 02/26/20 19:20:53
</code></pre>

<h2 id="sasl-gssapi">SASL/GSSAPI</h2>

<p>Autentificación simple con LDAP.</p>

<p>LDAP nos permite autenticarnos utilizando Simple Authentication and Security Layer(SASL) y con kerberos mediante GSSAPI.</p>

<p>Para ello vamos a instalar los paquetes necesarios.</p>

<pre><code>debian@croqueta:~$ sudo apt install libsasl2-modules-gssapi-mit
</code></pre>

<p>Vamos a cambiar los permisos al siguiente fichero, para que ldap pueda acceder.</p>

<pre><code>debian@croqueta:~$ chgrp openldap /etc/krb5.keytab 
debian@croqueta:~$ sudo chgrp openldap /etc/krb5.keytab 
</code></pre>

<p>A continuación vamos a añadir al fichero de configuración de slapd lo siguiente.</p>

<pre><code>debian@croqueta:~$ sudo nano /etc/ldap/sasl2/slapd.conf

mech_list: GSSAPI
</code></pre>

<pre><code>debian@croqueta:~$ sudo nano /etc/ldap/ldap.conf 

SASL_MECH GSSAPI
SASL_REALM ERNESTO.GONZALONAZARENO.ORG
SASL_NOCANON ON
</code></pre>

    </section>
    <footer class="post-footer">
      
    </footer>
  </article>
</main>

        <footer class="site-footer">
  <section class="rss"><a class="subscribe-button icon-feed" href="/index.xml"></a></section>
  <section class="twitter"><a class="icon-twitter" href="https://twitter.com/ernestovazgar"> ernestovazgar</a></section>
  
  <section class="copyright">&copy; 2020 De Rookie a Leyenda</section>
  <section class="poweredby"><a href="https://github.com/nirocfz/arabica">Arabica</a> theme by Sean Lunsford. Published with <a href="https://gohugo.io">Hugo</a>.</section>
</footer>



    </body>
</html>
